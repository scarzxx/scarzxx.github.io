<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moderní RSS Čtečka se Záložkami</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7f6;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 25px;
        }

        #loading-message {
            text-align: center;
            font-size: 1.2em;
            color: #7f8c8d;
            padding: 20px;
        }

        /* Styly pro záložky */
        .tabs-navigation {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tab-button {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background-color: transparent;
            font-size: 1em;
            color: #3498db;
            border-bottom: 3px solid transparent;
            margin-bottom: -1px; /* Aby překryl border-bottom .tabs-navigation */
            transition: color 0.3s, border-bottom-color 0.3s;
        }

        .tab-button:hover {
            color: #2980b9;
        }

        .tab-button.active {
            color: #2c3e50;
            border-bottom-color: #2980b9;
            font-weight: bold;
        }

        .tab-content-panel {
            display: none; /* Skryté defaultně */
        }

        .tab-content-panel.active {
            display: block; /* Zobrazí se aktivní panel */
        }
        
        .error-message-feed {
            color: red;
            padding: 15px;
            background-color: #ffebee;
            border: 1px solid #e57373;
            border-radius: 4px;
            margin-top: 10px;
        }
        .no-items-message {
            color: #777;
            padding: 15px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-top: 10px;
            text-align: center;
        }

        .rss-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding-top: 10px; /* malý odstup od záložek */
        }

        .rss-item {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            display: flex;
            flex-direction: column;
        }

        .rss-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .rss-item-image-container {
            width: 100%;
            height: 180px; /* Pevná výška pro obrázek/placeholder */
            background-color: #ecf0f1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .rss-item-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .rss-item-image-placeholder-text {
            color: #bdc3c7;
            font-size: 1em;
        }

        .rss-item-content {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .rss-item-title {
            font-size: 1.2em;
            font-weight: bold;
            margin: 0 0 10px 0;
        }

        .rss-item-title a {
            text-decoration: none;
            color: #2980b9;
        }

        .rss-item-title a:hover {
            text-decoration: underline;
        }

        .rss-item-description {
            font-size: 0.9em;
            color: #555;
            line-height: 1.5;
            flex-grow: 1;
            margin-bottom: 10px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
        }
        
        .rss-item-description img {
            display: none;
        }

        .rss-item-date {
            font-size: 0.8em;
            color: #7f8c8d;
            margin-top: auto;
            text-align: right;
        }

        @media (max-width: 768px) {
            .tab-button {
                font-size: 0.9em;
                padding: 8px 12px;
            }
        }
        @media (max-width: 600px) {
            .rss-grid {
                grid-template-columns: 1fr;
            }
            h1 {
                font-size: 1.8em;
            }
            .tabs-navigation {
                justify-content: space-around; /* Lepší na mobilu */
            }
            .tab-button {
                 flex-grow: 1; /* Aby tlačítka vyplnila šířku */
                 text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Moje RSS Feedy</h1>
        <div id="loading-message">Načítám RSS kanály...</div>
        
        <div class="tabs-container">
            <div class="tabs-navigation" id="tabs-nav">
                <!-- Tlačítka záložek budou vložena sem JavaScriptem -->
            </div>
            <div class="tabs-content-panels" id="tabs-content">
                <!-- Obsahové panely záložek budou vloženy sem JavaScriptem -->
            </div>
        </div>
    </div>

    <script>
        const rssFeeds = [
            { name: "Kinobox Novinky", url: "https://raw.githubusercontent.com/scarzxx/kinobox-rss/refs/heads/main/feed/kinobox_novinky_rss.xml" },
            { name: "Kinobox Trendy", url: "https://raw.githubusercontent.com/scarzxx/kinobox-rss/refs/heads/main/feed/kinobox_novinky_rss.xml" },
            { name: "TMDB Populární Filmy", url: "https://raw.githubusercontent.com/scarzxx/kinobox-rss/refs/heads/main/feed/tmdb_popular_rss.xml" },
            { name: "TMDB TV Seriály", url: "https://raw.githubusercontent.com/scarzxx/kinobox-tmdb-rss-cz/refs/heads/main/feed/tmdb_tv_rss.xml" }
        ];

        const tabsNavContainer = document.getElementById('tabs-nav');
        const tabsContentContainer = document.getElementById('tabs-content');
        const loadingMessage = document.getElementById('loading-message');

        function extractImageUrlFromHtml(htmlString) {
            if (!htmlString) return null;
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlString, 'text/html');
            const img = doc.querySelector('img');
            return img ? img.src : null;
        }

        function stripHtml(html) {
            const tempDiv = document.createElement("div");
            tempDiv.innerHTML = html;
            return tempDiv.textContent || tempDiv.innerText || "";
        }

        function switchTab(activeIndex) {
            // Deaktivace všech tlačítek a panelů
            tabsNavContainer.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            tabsContentContainer.querySelectorAll('.tab-content-panel').forEach(panel => {
                panel.classList.remove('active');
            });

            // Aktivace vybraného tlačítka a panelu
            tabsNavContainer.querySelector(`.tab-button[data-index="${activeIndex}"]`).classList.add('active');
            tabsContentContainer.querySelector(`.tab-content-panel[data-index="${activeIndex}"]`).classList.add('active');
        }

        async function fetchAndDisplayFeeds() {
            // Vytvoření tlačítek a panelů pro záložky
            rssFeeds.forEach((feed, index) => {
                const button = document.createElement('button');
                button.className = 'tab-button';
                button.textContent = feed.name;
                button.dataset.index = index;
                button.addEventListener('click', () => switchTab(index));
                tabsNavContainer.appendChild(button);

                const panel = document.createElement('div');
                panel.className = 'tab-content-panel';
                panel.dataset.index = index;
                tabsContentContainer.appendChild(panel);
            });

            let feedsProcessed = 0;

            for (let i = 0; i < rssFeeds.length; i++) {
                const feed = rssFeeds[i];
                const currentPanel = tabsContentContainer.querySelector(`.tab-content-panel[data-index="${i}"]`);
                
                try {
                    const response = await fetch(feed.url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const xmlText = await response.text();
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(xmlText, "application/xml");
                    
                    const items = xmlDoc.querySelectorAll("item");
                    
                    if (items.length > 0) {
                        const gridElement = document.createElement('div');
                        gridElement.className = 'rss-grid';
                        
                        items.forEach(item => {
                            const title = item.querySelector("title")?.textContent || "Bez názvu";
                            const link = item.querySelector("link")?.textContent || "#";
                            const descriptionHTML = item.querySelector("description")?.textContent || "";
                            const pubDateStr = item.querySelector("pubDate")?.textContent;

                            let imageUrl = extractImageUrlFromHtml(descriptionHTML);
                            
                            // Hledání obrázku v <media:thumbnail> nebo <enclosure> pokud nebyl v description
                            if (!imageUrl) {
                                const mediaThumbnail = item.querySelector('media\\:thumbnail, thumbnail'); // Zkouší s i bez namespace prefixu
                                if (mediaThumbnail) {
                                    imageUrl = mediaThumbnail.getAttribute('url');
                                }
                            }
                            if (!imageUrl) {
                                const enclosure = item.querySelector('enclosure[type^="image/"]');
                                if (enclosure) {
                                    imageUrl = enclosure.getAttribute('url');
                                }
                            }

                            const cleanDescription = stripHtml(descriptionHTML);

                            let formattedDate = "Neznámé datum";
                            if (pubDateStr) {
                                try {
                                    const date = new Date(pubDateStr);
                                    formattedDate = date.toLocaleDateString('cs-CZ', {
                                        year: 'numeric', month: 'long', day: 'numeric'
                                    });
                                } catch (e) { console.warn("Chyba parsování data:", pubDateStr, e); }
                            }
                            
                            const itemElement = document.createElement('div');
                            itemElement.className = 'rss-item';

                            const imageContainer = document.createElement('div');
                            imageContainer.className = 'rss-item-image-container';

                            if (imageUrl) {
                                const imgElement = document.createElement('img');
                                imgElement.src = imageUrl;
                                imgElement.alt = title;
                                imgElement.className = 'rss-item-image';
                                imgElement.onerror = function() {
                                    this.style.display = 'none';
                                    const placeholderText = document.createElement('span');
                                    placeholderText.className = 'rss-item-image-placeholder-text';
                                    placeholderText.textContent = 'Obrázek nedostupný';
                                    // Ujistěte se, že se placeholder přidá jen jednou
                                    if (!imageContainer.querySelector('.rss-item-image-placeholder-text')) {
                                        imageContainer.appendChild(placeholderText);
                                    }
                                };
                                imageContainer.appendChild(imgElement);
                            } else {
                                const placeholderText = document.createElement('span');
                                placeholderText.className = 'rss-item-image-placeholder-text';
                                placeholderText.textContent = 'Žádný obrázek';
                                imageContainer.appendChild(placeholderText);
                            }
                            itemElement.appendChild(imageContainer);
                            
                            const contentElement = document.createElement('div');
                            contentElement.className = 'rss-item-content';

                            const titleElement = document.createElement('h3');
                            titleElement.className = 'rss-item-title';
                            const linkElement = document.createElement('a');
                            linkElement.href = link;
                            linkElement.target = "_blank";
                            linkElement.rel = "noopener noreferrer";
                            linkElement.textContent = title;
                            titleElement.appendChild(linkElement);
                            
                            const descriptionElement = document.createElement('p');
                            descriptionElement.className = 'rss-item-description';
                            descriptionElement.textContent = cleanDescription;

                            const dateElement = document.createElement('p');
                            dateElement.className = 'rss-item-date';
                            dateElement.textContent = formattedDate;

                            contentElement.appendChild(titleElement);
                            contentElement.appendChild(descriptionElement);
                            contentElement.appendChild(dateElement);
                            itemElement.appendChild(contentElement);
                            gridElement.appendChild(itemElement);
                        });
                        currentPanel.appendChild(gridElement);
                    } else {
                         const noItemsMsg = document.createElement('p');
                         noItemsMsg.className = 'no-items-message';
                         noItemsMsg.textContent = `V tomto kanálu nebyly nalezeny žádné položky.`;
                         currentPanel.appendChild(noItemsMsg);
                    }

                } catch (error) {
                    console.error(`Chyba při načítání RSS kanálu ${feed.name}:`, error);
                    const errorElement = document.createElement('p');
                    errorElement.className = 'error-message-feed';
                    errorElement.textContent = `Nepodařilo se načíst kanál: ${feed.name}. (${error.message})`;
                    currentPanel.appendChild(errorElement);
                } finally {
                    feedsProcessed++;
                    if (feedsProcessed === rssFeeds.length) {
                        loadingMessage.style.display = 'none';
                        if (rssFeeds.length > 0) {
                            switchTab(0); // Aktivovat první záložku po načtení všeho
                        }
                    }
                }
            }
        }

        document.addEventListener('DOMContentLoaded', fetchAndDisplayFeeds);
    </script>
</body>
</html>
